<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>VR Memory Match Game</title>
    <meta name="description" content="Memory Match Game in VR">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        #ui {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        #ui h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        #ui button {
            padding: 8px 16px;
            margin: 5px;
            background-color: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        #ui button:hover {
            background-color: #219a52;
        }
        
        .instructions {
            max-width: 300px;
            font-size: 14px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <!-- UI Overlay -->
    <div id="ui">
        <h3>🧠 VR Memory Match Game</h3>
        <div class="instructions">
            <p><strong>Goal:</strong> Find all 6 matching pairs!</p>
            <p><strong>Controls:</strong></p>
            <ul>
                <li>Look at a card and pull trigger to flip it</li>
                <li>Find matching pairs to make them disappear</li>
                <li>Use thumbstick to move around</li>
            </ul>
            <p><strong>Score:</strong> <span id="score">0</span>/6 pairs found</p>
        </div>
        <button onclick="resetGame()">🔄 New Game</button>
        <button onclick="toggleInstructions()">📖 Toggle Instructions</button>
    </div>

    <!-- A-Frame VR Scene -->
    <a-scene 
        background="color: #00C9FF"
        vr-mode-ui="enabled: true"
        device-orientation-permission-ui="enabled: true">
        
        <!-- Assets -->
        <a-assets>
            <!-- Card materials -->
            <a-mixin id="card-base" 
                     geometry="primitive: box; width: 1; height: 1.4; depth: 0.1"
                     material="color: #FFB0B0"
                     animation__mouseenter="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
                     animation__mouseleave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200">
            </a-mixin>
            
            <a-mixin id="card-flipped"
                     material="color: #B1B5FC">
            </a-mixin>
            
            <a-mixin id="card-matched"
                     material="color: #2ecc71; opacity: 0.5">
            </a-mixin>
        </a-assets>

        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="point" position="0 5 0" color="#ffffff"></a-light>

        <!-- Game Board Container -->
        <a-entity id="gameBoard" position="0 2 -4">
            <!-- Cards will be generated here by JavaScript -->
        </a-entity>

        <!-- Instructions Text in VR -->
        <a-text id="vrInstructions"
                value="Welcome to VR Memory Match!\nLook at cards and pull trigger to flip them.\nFind all 6 matching pairs to win!"
                position="0 4 -4"
                align="center"
                color="#2c3e50"
                width="8">
        </a-text>

        <!-- Score Display in VR -->
        <a-text id="vrScore"
                value="Matches: 0/6"
                position="0 3.5 -4"
                align="center"
                color="#27ae60"
                width="6">
        </a-text>

        <!-- Win Message (hidden initially) -->
        <a-text id="winMessage"
                value="🎉 CONGRATULATIONS! 🎉\nYou found all pairs!\nLook at the New Game button to play again!"
                position="0 2.5 -3"
                align="center"
                color="#f39c12"
                width="10"
                visible="false">
        </a-text>

        <!-- New Game Button in VR -->
        <a-box id="newGameButton"
               position="0 1 -3"
               width="2" height="0.5" depth="0.1"
               color="#e74c3c"
               text="value: 🔄 New Game; align: center; width: 8; color: white"
               class="clickable">
        </a-box>

        <!-- Camera with VR controls -->
        <a-entity id="rig" movement-controls position="0 1.6 0">
            <a-camera look-controls wasd-controls>
                <a-cursor
                    position="0 0 -1"
                    geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                    material="color: white; shader: flat"
                    raycaster="objects: .clickable">
                </a-cursor>
            </a-camera>
            
            <!-- VR Controllers -->
            <a-entity id="leftHand" 
                      hand-controls="hand: left; handModelStyle: lowPoly; color: #ffcccc"
                      laser-controls raycaster="objects: .clickable"
                      line="color: red; opacity: 0.75">
            </a-entity>
            
            <a-entity id="rightHand" 
                      hand-controls="hand: right; handModelStyle: lowPoly; color: #ccffcc"  
                      laser-controls raycaster="objects: .clickable"
                      line="color: blue; opacity: 0.75">
            </a-entity>
        </a-entity>
    </a-scene>

    <script>
        // Game variables
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let canFlip = true;
        let gameStarted = false;

        // Shapes for the cards
        const shapes = ['⭐', '❤️', '🔥', '⚡', '🌙', '☀️'];

        // Initialize the VR game
        function initGame() {
            const gameBoard = document.getElementById('gameBoard');
            
            // Clear existing cards
            while (gameBoard.firstChild) {
                gameBoard.removeChild(gameBoard.firstChild);
            }
            
            cards = [];
            flippedCards = [];
            matchedPairs = 0;
            canFlip = true;
            gameStarted = true;
            
            // Hide win message
            document.getElementById('winMessage').setAttribute('visible', false);
            
            // Create pairs of shapes
            const cardShapes = [...shapes, ...shapes];
            shuffleArray(cardShapes);
            
            // Create 3D cards in a 4x3 grid
            cardShapes.forEach((shape, index) => {
                const row = Math.floor(index / 4);
                const col = index % 4;
                
                // Calculate position (centered grid)
                const x = (col - 1.5) * 1.2; // 1.2 spacing between cards
                const y = (1 - row) * 1.6;   // 1.6 spacing between rows
                const z = 0;
                
                // Create card entity
                const card = document.createElement('a-entity');
                card.setAttribute('mixin', 'card-base');
                card.setAttribute('position', `${x} ${y} ${z}`);
                card.setAttribute('class', 'clickable card');
                
                // Add question mark text
                const cardText = document.createElement('a-text');
                cardText.setAttribute('value', '?');
                cardText.setAttribute('position', '0 0 0.06');
                cardText.setAttribute('align', 'center');
                cardText.setAttribute('color', 'white');
                cardText.setAttribute('width', '8');
                card.appendChild(cardText);
                
                // Store card data
                card.dataset.shape = shape;
                card.dataset.index = index;
                card.dataset.flipped = 'false';
                card.dataset.matched = 'false';
                
                // Add click event
                card.addEventListener('click', flipCard);
                
                cards.push(card);
                gameBoard.appendChild(card);
            });
            
            updateScore();
        }

        // Shuffle array function
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Flip card function for VR
        function flipCard(event) {
            const card = event.target;
            
            if (!canFlip || card.dataset.flipped === 'true' || card.dataset.matched === 'true') {
                return;
            }
            
            // Flip the card
            card.setAttribute('mixin', 'card-base card-flipped');
            card.dataset.flipped = 'true';
            
            // Update card text to show shape
            const cardText = card.querySelector('a-text');
            cardText.setAttribute('value', card.dataset.shape);
            cardText.setAttribute('color', 'white');
            
            flippedCards.push(card);
            
            // Check if two cards are flipped
            if (flippedCards.length === 2) {
                canFlip = false;
                setTimeout(checkMatch, 1500);
            }
        }

        // Check if cards match
        function checkMatch() {
            const [card1, card2] = flippedCards;
            
            if (card1.dataset.shape === card2.dataset.shape) {
                // Cards match!
                card1.setAttribute('mixin', 'card-base card-matched');
                card2.setAttribute('mixin', 'card-base card-matched');
                card1.dataset.matched = 'true';
                card2.dataset.matched = 'true';
                matchedPairs++;
                updateScore();
                
                // Check if game is won
                if (matchedPairs === 6) {
                    setTimeout(showWinMessage, 1000);
                }
            } else {
                // Cards don't match, flip them back
                card1.setAttribute('mixin', 'card-base');
                card2.setAttribute('mixin', 'card-base');
                card1.dataset.flipped = 'false';
                card2.dataset.flipped = 'false';
                
                // Reset text to question marks
                card1.querySelector('a-text').setAttribute('value', '?');
                card2.querySelector('a-text').setAttribute('value', '?');
            }
            
            flippedCards = [];
            canFlip = true;
        }

        // Update score display
        function updateScore() {
            document.getElementById('score').textContent = matchedPairs;
            document.getElementById('vrScore').setAttribute('value', `Matches: ${matchedPairs}/6`);
        }

        // Show win message in VR
        function showWinMessage() {
            document.getElementById('winMessage').setAttribute('visible', true);
            // Add celebration animation
            document.getElementById('winMessage').setAttribute('animation', 
                'property: rotation; to: 0 360 0; loop: true; dur: 3000');
        }

        // Reset game
        function resetGame() {
            initGame();
        }

        // Toggle instructions visibility
        function toggleInstructions() {
            const instructions = document.querySelector('.instructions');
            instructions.style.display = instructions.style.display === 'none' ? 'block' : 'none';
        }

        // Set up new game button click in VR
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('newGameButton').addEventListener('click', resetGame);
            
            // Start the game automatically
            setTimeout(initGame, 1000);
        });
    </script>
</body>
</html>
