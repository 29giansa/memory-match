<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>VR Memory Match Game</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body>
    <a-scene background="color: #00C9FF">
        
        <!-- Game Title -->
        <a-text 
            value="VR Memory Match Game" 
            position="0 3 -4" 
            align="center" 
            color="black"
            scale="1.5 1.5 1.5">
        </a-text>

        <!-- Score Display -->
        <a-text 
            id="scoreText"
            value="Matches: 0/6" 
            position="0 2.5 -4" 
            align="center" 
            color="black">
        </a-text>

        <!-- Game Board -->
        <a-entity id="gameBoard" position="0 0 -4">
            <!-- Cards will be created here -->
        </a-entity>

        <!-- Reset Button -->
        <a-box 
            id="resetButton"
            position="0 -2.5 -4" 
            width="1.5" 
            height="0.5" 
            depth="0.1"
            color="red"
            class="clickable">
            <a-text 
                value="New Game" 
                position="0 0 0.06" 
                align="center" 
                color="white">
            </a-text>
        </a-box>

        <!-- Win Message -->
        <a-text 
            id="winMessage"
            value="You Won! Congratulations!" 
            position="0 1.5 -4" 
            align="center" 
            color="orange"
            scale="1.2 1.2 1.2"
            visible="false">
        </a-text>

        <!-- Camera with cursor -->
        <a-camera>
            <a-cursor 
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                material="color: white"
                raycaster="objects: .clickable">
            </a-cursor>
        </a-camera>

    </a-scene>

    <script>
        // Wait for A-frame to load
        document.addEventListener('DOMContentLoaded', function() {
            // Give A-frame time to initialize
            setTimeout(initGame, 1000);
        });

        // Game variables
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let canFlip = true;
        const shapes = ['‚≠ê', '‚ù§Ô∏è', 'üî•', '‚ö°', 'üåô', '‚òÄÔ∏è'];

        function initGame() {
            console.log("Starting game..."); // Debug log
            
            const gameBoard = document.querySelector('#gameBoard');
            if (!gameBoard) {
                console.error("Game board not found!");
                return;
            }

            // Clear existing cards
            gameBoard.innerHTML = '';
            
            cards = [];
            flippedCards = [];
            matchedPairs = 0;
            canFlip = true;
            
            // Hide win message
            const winMessage = document.querySelector('#winMessage');
            if (winMessage) {
                winMessage.setAttribute('visible', 'false');
            }
            
            // Create pairs of shapes
            const cardShapes = [...shapes, ...shapes];
            shuffleArray(cardShapes);
            
            // Create cards in a 4x3 grid
            for (let i = 0; i < 12; i++) {
                const row = Math.floor(i / 4);
                const col = i % 4;
                
                // Position cards
                const x = (col - 1.5) * 1.2;
                const y = (1 - row) * 1.2;
                
                // Create card
                const card = document.createElement('a-box');
                card.setAttribute('class', 'clickable');
                card.setAttribute('position', `${x} ${y} 0`);
                card.setAttribute('width', '1');
                card.setAttribute('height', '1');
                card.setAttribute('depth', '0.1');
                card.setAttribute('color', '#FFB0B0');
                card.dataset.shape = cardShapes[i];
                card.dataset.index = i;
                
                // Add text to card
                const cardText = document.createElement('a-text');
                cardText.setAttribute('value', '?');
                cardText.setAttribute('position', '0 0 0.06');
                cardText.setAttribute('align', 'center');
                cardText.setAttribute('color', 'white');
                cardText.setAttribute('scale', '2 2 2');
                
                card.appendChild(cardText);
                
                // Add click event
                card.addEventListener('click', function() {
                    flipCard(card);
                });
                
                cards.push(card);
                gameBoard.appendChild(card);
            }
            
            updateScore();
            
            // Setup reset button
            const resetButton = document.querySelector('#resetButton');
            if (resetButton) {
                resetButton.addEventListener('click', initGame);
            }
            
            console.log("Game initialized with", cards.length, "cards");
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function flipCard(card) {
            if (!canFlip || card.flipped || card.matched) {
                return;
            }
            
            // Flip the card
            card.flipped = true;
            card.setAttribute('color', '#B1B5FC');
            card.querySelector('a-text').setAttribute('value', card.dataset.shape);
            flippedCards.push(card);
            
            if (flippedCards.length === 2) {
                canFlip = false;
                setTimeout(checkMatch, 1000);
            }
        }

        function checkMatch() {
            const [card1, card2] = flippedCards;
            
            if (card1.dataset.shape === card2.dataset.shape) {
                // Match!
                card1.matched = true;
                card2.matched = true;
                card1.setAttribute('color', '#2ecc71');
                card2.setAttribute('color', '#2ecc71');
                matchedPairs++;
                updateScore();
                
                if (matchedPairs === 6) {
                    setTimeout(showWinMessage, 500);
                }
            } else {
                // No match
                card1.flipped = false;
                card2.flipped = false;
                card1.setAttribute('color', '#FFB0B0');
                card2.setAttribute('color', '#FFB0B0');
                card1.querySelector('a-text').setAttribute('value', '?');
                card2.querySelector('a-text').setAttribute('value', '?');
            }
            
            flippedCards = [];
            canFlip = true;
        }

        function updateScore() {
            const scoreText = document.querySelector('#scoreText');
            if (scoreText) {
                scoreText.setAttribute('value', `Matches: ${matchedPairs}/6`);
            }
        }

        function showWinMessage() {
            const winMessage = document.querySelector('#winMessage');
            if (winMessage) {
                winMessage.setAttribute('visible', 'true');
            }
        }
    </script>
</body>
</html>
